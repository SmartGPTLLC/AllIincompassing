# AGENTS.md â€“Â Operating Rules for CodexÂ Agents

> **Scope** â€“Â These rules apply to *all* files under this repository. Any PR opened by an AI agent **must** respect the constraints below.Â Failures to comply will cause the CI pipeline to reject the change.Â Â (See Codex systemâ€‘prompt specÂ ([baoyu.io](https://baoyu.io/blog/codex-system-prompt?utm_source=chatgpt.com)).)

---

## ðŸ“Â Directoryâ€‘level permissions

| Path                                                                    | May the agent modify? | Notes                                                                                                                                                               |
| ----------------------------------------------------------------------- | --------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `/src/**`                                                               | **YES**               | Application code only. Follow codeâ€‘style rules below.                                                                                                               |
| `/supabase/migrations/**`                                               | **YES**               | Add/adjust SQL migrations generated by `supabase db diff --use-migrations`Â ([datacamp.com](https://www.datacamp.com/tutorial/openai-codex?utm_source=chatgpt.com)). |
| `/supabase/functions/**`                                                | **YES**               | Deploy withÂ `supabase functions deploy --use-api` (no Docker)Â ([supabase.com](https://supabase.com/docs/guides/functions/deploy?utm_source=chatgpt.com)).           |
| `/docs/**`, `README.md`, `AGENTS.md`                                    | **YES**               | Keep docs in sync with code changes.                                                                                                                                |
| `.github/**`, `infra/**`, `Dockerfile`, `.env`, `.supabase/config.toml` | **NO**                | Infrastructure and secrets are humanâ€‘only; propose but never commit changes.                                                                                        |

---

## ðŸ”‘Â Secrets & Environment

1. **Secrets live in CodexÂ â†’Â Secrets**, never hardâ€‘code or print them. Mask as `****` in logsÂ ([datacamp.com](https://www.datacamp.com/tutorial/openai-codex?utm_source=chatgpt.com)).
2. Use the following envÂ vars, already injected at runtime:
   - `SUPABASE_URL`, `SUPABASE_ANON_KEY` â€“Â readâ€‘only client creds.
   - `SUPABASE_SERVICE_ROLE_KEY` â€“Â write/migration power.
   - `SUPABASE_ACCESS_TOKEN` â€“Â CLI auth token.
3. Generate Viteâ€‘friendly keys in `.env` **during setup only**; do **not** commit `.env` to git.
4. Always run the SupabaseÂ CLI with `--project-ref wnnjeqheqxxyrgsjmygy` **or** ensure `.supabase/project.toml` contains that ref to avoid interactive promptsÂ ([supabase.com](https://supabase.com/docs/reference/cli/start?utm_source=chatgpt.com)).
5. **Never** invoke Dockerâ€‘dependent commands (`supabase status`, `start`, `serve`, `db reset`) inside Codexâ€”they fail without a Docker daemonÂ ([baoyu.io](https://baoyu.io/blog/codex-system-prompt?utm_source=chatgpt.com)).

---

## ðŸ—ï¸Â Codingâ€‘standards

- **TypeScript / React** â€“Â follow Airbnb style via project ESLint + PrettierÂ settingsÂ ([gist.github.com](https://gist.github.com/ruvnet/ba1497632143ea9f12062c9c2c1879ad?utm_source=chatgpt.com)).
- **Exports** â€“Â use **named exports**; no default exports.
- **Testing** â€“Â every logic change needs a Jest test; run `npm test`, `eslint .`, and `tsc --noEmit` before opening a PRÂ ([datacamp.com](https://www.datacamp.com/tutorial/openai-codex?utm_source=chatgpt.com)).
- **Commits** â€“Â use ConventionalÂ Commits (`feat(scope):Â summary`)Â ([gist.github.com](https://gist.github.com/ruvnet/ba1497632143ea9f12062c9c2c1879ad?utm_source=chatgpt.com)).
- **Coverage** â€“Â maintain â‰¥â€¯90Â % line coverage; CI fails below this threshold.

---

## ðŸ—„ï¸Â DatabaseÂ &Â Migrations

1. **Create migrations locally** with `supabase migration new` or via `db diff --use-migrations`Â ([datacamp.com](https://www.datacamp.com/tutorial/openai-codex?utm_source=chatgpt.com)).
2. **Apply migrations** with `supabase db push -p wnnjeqheqxxyrgsjmygy` (cloudâ€‘only).
3. After every push, **regenerate types**:
   ```bash
   supabase gen types typescript \
     --schema public \
     -p wnnjeqheqxxyrgsjmygy \
     > src/lib/generated/database.types.ts
   ```
4. Ensure **Rowâ€‘Level Security** is enabled on new tables and at least one policy allows the intended accessÂ ([docs.supabase.com](https://docs.supabase.com/?utm_source=chatgpt.com)).

---

## ðŸš¦Â CI Gate

The CI pipeline will:

1. Reâ€‘run the setup script (see `/scripts/setup.sh`).
2. Enforce lint, tests, typeâ€‘check.
3. Reject PRs touching forbidden paths or failing any step.

---

## ðŸ¤–Â Pullâ€‘Request template the agent must use

```
### Summary
<oneâ€‘sentence overview>

### Proposed changes
- Bullet 1
- Bullet 2

### Tests added/updated
- jest/path/to/test.ts

### Checklist
- [ ] `npm test` passed
- [ ] `eslint .` passed
- [ ] `tsc --noEmit` passed
- [ ] Supabase types regenerated
```

PR body rules sourced from Codex docs on AGENTS.md PRâ€‘guidanceÂ ([baoyu.io](https://baoyu.io/blog/codex-system-prompt?utm_source=chatgpt.com)).

---

## ðŸ“œÂ Changelog

- **v1.0 (2025â€‘06â€‘23)**Â â€“Â Initial agent guidelines drafted from OpenAI Codex bestâ€‘practices and Supabase CLI docsÂ ([agentsmd.net](https://agentsmd.net/?utm_source=chatgpt.com), [supabase.com](https://supabase.com/docs/guides/functions/deploy?utm_source=chatgpt.com), [baoyu.io](https://baoyu.io/blog/codex-system-prompt?utm_source=chatgpt.com), [github.com](https://github.com/orgs/supabase/discussions/12639?utm_source=chatgpt.com)).

